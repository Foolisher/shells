# 解耦

> 系统设计中一个非常重要的原则是低耦合，为什么要低耦合呢，以及耦合度高的系统设计会带来哪些问题？
>
> 复杂的系统一般都有许多逻辑，总是会经过几番修改迭代，常常加入一些逻辑或删除一些逻辑，那么如何保证迭代过程是严谨的，安全的，如何保证加入一些逻辑依然保证系统的结构是清晰的，如何保证删除或重构一些逻辑对原有逻辑是安全的，兼容的呢？

对于一个博客系统，用户提交博客数据\(BlogService\)，保持博客数据\(BlogDao\)，博客数据可以查询\(BlogSearcher\)了，看起来这个博客发布系统就ok了。但突然有一天发现很大一批用户提交了非法敏感词的博客，需要加入敏感词校验和屏蔽逻辑，于是工程师开始修改BlogService代码加入敏感词校验，很快ok发布上线。系统运行一段时间后希望在发布博客后对博客中@到的人都发一个消息通知，工程师接到任务后又在BlogService中加入@解析逻辑和消息发送逻辑；有一天产品经理提出某些用户不能发布某些类别的博客，于是程序员接到任务后又开始改了起来，查询名单库，查询用户权限，判断是否允许用户发布......久而久之，博客系统的发布流程越来越庞大，代码逻辑越来越多。维护开始变得困难。

对付这样的系统不断演进逻辑，如何保持系统的主线（发布博客）是清晰的？如何让后来加入的功能是容易的呢？

软件设计原则里面有一条就是：**开闭原则。**开闭原则要求对修改关闭，修改说明这个逻辑的封装不够严谨完善，不是说完全不让修改，而是说如何尽可能的不去修改它就能优雅的升级，或者说即使修改它的代价是尽量小的，带来的影响是尽量少的。

那么做到开闭原则有哪些方法呢？

1. **接口细粒度**：接口的粒度越细，隔离得越清晰，避免了对一个接口的修改对其他接口带来的影响，但是太细又会分散一定的封装性，所以，接口粒度的的设计需要根据具体情况来约束
2. **依赖倒置原则**：我们熟知的依赖倒置手段有Spring的IOC注入过程，还有事件总线模型通过事件的订阅与发布解耦，主流程依赖的是事件总线，而不依赖不确定的处理逻辑；通过消息中心作为异步解耦，也是一种事件型解耦手段，但这样的解耦方法在消息的跟踪上要做到详细的跟踪方案保障系统的稳定性与可维护性。还有插件模式、拦截器模式、甚至AOP等手段来解耦依赖服务



